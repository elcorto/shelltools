#!/bin/sh

set -e

[ -d /dev/shm ] && logbase=/dev/shm || logbase=/tmp
logfile=$(mktemp -p $logbase logrun.XXXXXXXXXXX)

cleanup(){
    rm -f $logfile
}

trap cleanup EXIT STOP INT QUIT KILL ABRT TERM HUP

usage(){
    local prog=$(basename $0)
    cat << eof
Run
    eval "<command> ..." 2>&1 | tee \$logfile; less -i \$logfile

Usage:
    $prog <command> [args]

Quote when needed:
    $prog "<command> [args] | grep stuff"
eof
}

while getopts h opt; do
    case $opt in
        h)  usage; exit 0;;
        \?) exit 1;;
    esac
done
shift $((OPTIND - 1))


# test whether logfile is writable
echo "test" > $logfile

eval "$@" 2>&1 | tee $logfile; less -i $logfile
